---
title: "Homework 5"
author: "CS 498, Spring 2018, Xiaoming Ji"
date: ''
output:
  html_document:
    toc: yes
  pdf_document: default
params:
  load_precomputed_data: yes
---


#Problem 1
At http://www.statsci.org/data/general/brunhild.html, you will find a dataset that measures the concentration of a sulfate in the blood of a baboon named Brunhilda as a function of time. Build a linear regression of the log of the concentration against the log of time.

##(a) 
Prepare a plot showing (a) the data points and (b) the regression line in log-log coordinates.

```{r}
brunhild = read.delim("brunhild.txt")
model = lm(log(Sulfate) ~ log(Hours), data = brunhild)
plot(log(brunhild$Hours), log(brunhild$Sulfate), xlab = "LOG(Hours)", ylab = "LOG()", col = "dodgerblue", pch = 20, cex = 1.5)
abline(model, col = "darkorange", lwd = 2)
```

##(b) 
Prepare a plot showing (a) the data points and (b) the regression curve in the original coordinates.
```{r}
plot(brunhild, col = "dodgerblue", pch = 20, cex = 1.5)
curve(exp(model$coefficients[1] + log(x) * model$coefficients[2]), from = min(brunhild$Hours), to = max(brunhild$Hours), add = TRUE, col = "darkorange", lwd = 2)
```

##(c) 
Plot the residual against the fitted values in log-log and in original coordinates.
```{r}
fit_values = exp(model$coefficients[1] + log(brunhild$Hours) * model$coefficients[2])
res_values = brunhild$Sulfate - fit_values
plot(fit_values, res_values, col = "dodgerblue",
pch = 20, cex = 1.5, xlab = "Fitted values", ylab = "Residuals")
abline(h = 0, lty = 2, col = "darkorange", lwd = 2)
```

##(d) 
Use your plots to explain whether your regression is good or bad and why.

Answer: If we just eye-exame  plot (a) and (b), it seems the model fits the data very well. However, good model also need to follow linearity and constant variance assumptions which is exposed by plot (c). 

- To check linearity assumptions, we need exam at any fitted value , the mean of the residuals should be roughly 0. This is not the case for most points in this plot.
- To check constant variance assumption in this plot, we need exam at every fitted value, the spread of the residuals should be roughly the same. This is not the case in this plot and we see the magnitude of residuals increase when fitted value increase. 

For these reasons, we believe this is a **bad** regression.

#Problem 2
At http://www.statsci.org/data/oz/physical.html, youwillfindadatasetofmea- surements by M. Larner, made in 1996. These measurements include body mass, and various diameters. Build a linear regression of predicting the body mass from these diameters.

##(a) 
Plot the residual against the fitted values for your regression.

##(b) 
Now regress the cube root of mass against these diameters. Plot the residual against the fitted values in both these cube root coordinates and in the original coordinates.

##(c) 
Use your plots to explain which regression is better.

#Problem 3
At https://archive.ics.uci.edu/ml/datasets/Abalone, you will find a dataset of measurements by W. J. Nash, T. L. Sellers, S. R. Talbot, A. J. Cawthorn and W. B. Ford, made in 1992. These are a variety of measurements of blacklip abalone (Haliotis rubra; delicious by repute) of various ages and genders.
##(a) 
Build a linear regression predicting the age from the measurements, ignoring gender. Plot the residual against the fitted values.

##(b) 
Build a linear regression predicting the age from the measurements, including gender. There are three levels for gender; Iâ€™m not sure whether this has to do with abalone biology or difficulty in determining gender. You can represent gender numerically by choosing 1 for one level, 0 for another, and -1 for the third. Plot the residual against the fitted values.

##(c) 
Now build a linear regression predicting the log of age from the measurements, ignoring gender. Plot the residual against the fitted values.

##(d) 
Now build a linear regression predicting the log age from the measurements, including gender, represented as above. Plot the residual against the fitted values.

##(e) 
Itturnsoutthatdeterminingtheageofanabaloneispossible,butdifficult (you section the shell, and count rings). Use your plots to explain which regression you would use to replace this procedure, and why.

##(f) 
Can you improve these regressions by using a regularizer? Use glmnet to obtain plots of the cross-validated prediction error.
